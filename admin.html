<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ZakMedCare Admin - Post Job</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/jquery.min.js"></script>
    <link rel="icon" type="image/png" href="images/logokaki.png">
    <style>
        .fade-in {
            animation: fadeIn 0.7s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .form-error {
            border-color: #EF4444 !important;
        }

        .job-action-btn {
            transition: background 0.2s;
        }

        .job-action-btn:hover {
            background: #e5e7eb;
        }
    </style>
</head>

<body
    class="bg-gradient-to-br from-blue-50 via-white to-green-50 min-h-screen flex flex-col items-center justify-center">

    <!-- Admin Login Box -->
    <div id="loginBox"
        class="bg-white fade-in shadow-2xl rounded-2xl p-8 w-full max-w-md transition-all duration-300 hover:shadow-blue-200">
        <div class="flex flex-col items-center mb-7">
            <img src="images/logokaki.png" alt="ZakMedCare Logo" class="w-20 h-20 mb-3 rounded-full shadow">
            <h2 class="text-3xl font-bold text-blue-700 mb-1">Admin Login</h2>
            <p class="text-gray-500 text-sm">Welcome back! Please sign in to continue.</p>
        </div>
        <div class="space-y-4">
            <input id="username" type="text" placeholder="Username"
                class="border p-2 w-full rounded focus:ring-2 focus:ring-blue-400 transition" autocomplete="username">
            <input id="password" type="password" placeholder="Password"
                class="border p-2 w-full rounded focus:ring-2 focus:ring-blue-400 transition"
                autocomplete="current-password">
            <div class="flex items-center justify-between text-xs text-gray-500">
                <label class="inline-flex items-center">
                    <input id="rememberMe" type="checkbox" class="form-checkbox text-blue-600">
                    <span class="ml-2">Remember me</span>
                </label>
            </div>
            <button id="loginBtn"
                class="w-full bg-blue-600 text-white font-semibold py-2 rounded hover:bg-blue-700 transition text-lg">
                Login
            </button>
            <div id="loginError" class="text-center text-red-500 text-xs font-medium hidden"></div>
        </div>
    </div>

    <!-- Centered Back to Website Button BELOW login box -->
    <div id="backToWebsiteWrap" class="flex justify-center mt-6">
        <a href="index.html"
            class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded shadow transition flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            Back to Website
        </a>
    </div>

    <!-- Upload Panel -->
    <div id="uploadSection" class="hidden fade-in mt-10 w-full max-w-2xl bg-white p-8 rounded-2xl shadow-2xl">
        <div class="flex flex-col items-center mb-7">
            <img src="images/logokaki.png" alt="ZakMedCare Logo" class="w-16 h-16 rounded-full shadow mb-2">
            <h3 class="text-2xl font-semibold text-blue-700 mb-1">Post New Job</h3>
            <p class="text-gray-500 text-sm">Fill in any details you want to create a new job post. All fields are
                optional.</p>
        </div>
        <form id="uploadForm" enctype="multipart/form-data" class="space-y-5">
            <div>
                <label class="block mb-1 font-medium">Job Title</label>
                <input type="text" name="title"
                    class="border p-2 w-full rounded focus:ring-2 focus:ring-blue-400 transition"
                    placeholder="Job Title">
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block mb-1 font-medium">Position</label>
                    <input type="text" name="position"
                        class="border p-2 w-full rounded focus:ring-2 focus:ring-blue-400 transition"
                        placeholder="e.g. Registered Nurse">
                </div>
                <div>
                    <label class="block mb-1 font-medium">Industry</label>
                    <input type="text" name="industry"
                        class="border p-2 w-full rounded focus:ring-2 focus:ring-blue-400 transition"
                        placeholder="e.g. Healthcare">
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block mb-1 font-medium">Location</label>
                    <input type="text" name="location"
                        class="border p-2 w-full rounded focus:ring-2 focus:ring-blue-400 transition"
                        placeholder="e.g. Dubai, UAE">
                </div>
                <div>
                    <label class="block mb-1 font-medium">Candidates Needed</label>
                    <input type="number" name="candidates" min="1"
                        class="border p-2 w-full rounded focus:ring-2 focus:ring-blue-400 transition"
                        placeholder="e.g. 5">
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block mb-1 font-medium">Salary (AED)</label>
                    <input type="text" name="salary"
                        class="border p-2 w-full rounded focus:ring-2 focus:ring-blue-400 transition"
                        placeholder="e.g. 8000 - 12000 AED">
                </div>
                <div>
                    <label class="block mb-1 font-medium">Experience (years)</label>
                    <input type="text" name="experience"
                        class="border p-2 w-full rounded focus:ring-2 focus:ring-blue-400 transition"
                        placeholder="e.g. 2-5 Years">
                </div>
            </div>
            <div>
                <label class="block mb-1 font-medium">License/Filter (select one or more)</label>
                <div class="flex flex-wrap gap-4">
                    <label class="inline-flex items-center">
                        <input type="checkbox" name="license[]" value="DHA" class="form-checkbox text-blue-600" />
                        <span class="ml-2">DHA</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="checkbox" name="license[]" value="HAAD" class="form-checkbox text-blue-600" />
                        <span class="ml-2">HAAD</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="checkbox" name="license[]" value="MOH" class="form-checkbox text-blue-600" />
                        <span class="ml-2">MOH</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="checkbox" name="license[]" value="DOH" class="form-checkbox text-blue-600" />
                        <span class="ml-2">DOH</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="checkbox" name="license[]" value="None" class="form-checkbox text-blue-600" />
                        <span class="ml-2">None</span>
                    </label>
                </div>
                <small class="text-gray-500">You can select more than one.</small>
            </div>
            <div>
                <label class="block mb-1 font-medium">Gender</label>
                <select name="gender" class="border p-2 w-full rounded focus:ring-2 focus:ring-blue-400 transition">
                    <option value="">Select</option>
                    <option value="Any">Any</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
            </div>
            <div>
                <label class="block mb-1 font-medium">Description</label>
                <textarea name="description"
                    class="border p-2 w-full rounded focus:ring-2 focus:ring-blue-400 transition" rows="3"
                    placeholder="Describe the job and requirements"></textarea>
            </div>
            <div>
                <label class="block mb-1 font-medium">Upload Image (Company Logo or Job Image)</label>
                <input type="file" name="image" id="imageInput" accept="image/*"
                    class="border p-2 w-full rounded focus:ring-2 focus:ring-blue-400 transition">
                <div id="imagePreviewWrap" class="mt-2 hidden relative">
                    <img id="imagePreview" src="#" alt="Preview"
                        class="w-48 h-48 object-contain rounded shadow border cursor-pointer transition hover:scale-105"
                        onclick="showImgModal(this.src)">
                    <button type="button" id="clearImageBtn"
                        class="absolute top-1 right-1 bg-white rounded-full px-2 py-0.5 text-red-600 border text-xs shadow hover:bg-gray-200">Clear</button>
                </div>
            </div>
            <button type="submit"
                class="bg-green-600 text-white px-7 py-2 rounded hover:bg-green-700 transition text-lg w-full">Submit
                Job</button>
        </form>
        <p id="uploadStatus" class="mt-4 text-green-700 font-medium text-center"></p>
    </div>

    <!-- Admin Job List -->
    <div id="adminJobListSection"
        class="hidden fade-in mt-10 w-full max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-2xl mb-10">
        <h3 class="text-2xl font-bold text-blue-700 mb-6 text-center">Your Posted Jobs</h3>
        <div id="adminJobList"></div>
        <!-- Back Button inside the Posted Jobs area -->
        <div class="flex justify-center mt-8">
            <a href="index.html"
                class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded shadow transition flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                Back to Website
            </a>
        </div>
    </div>

    <!-- Modal for Image Preview -->
    <div id="imgModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
        <span onclick="closeImgModal()"
            class="absolute top-8 right-8 text-white text-4xl font-bold cursor-pointer select-none">&times;</span>
        <img id="modalImage"
            class="max-w-4xl max-h-[90vh] w-full h-auto object-contain rounded shadow-xl border-4 border-white bg-white"
            src="" alt="Preview">
    </div>

    <script>
        // Admin credentials
        const adminUser = "zakir";
        const adminPass = "zakir123";

        // Load remembered credentials if available
        $(document).ready(function () {
            if (localStorage.getItem("zakmedcare_admin_user")) {
                $('#username').val(localStorage.getItem("zakmedcare_admin_user"));
            }
            if (localStorage.getItem("zakmedcare_admin_pass")) {
                $('#password').val(localStorage.getItem("zakmedcare_admin_pass"));
                $('#rememberMe').prop('checked', true);
            }
            renderAdminJobList();
        });

        function showError(msg) {
            $("#loginError").text(msg).fadeIn(200).removeClass("hidden");
        }
        function hideError() {
            $("#loginError").fadeOut(100, function () { $(this).addClass("hidden"); });
        }

        // Login Handling
        $('#loginBtn').click(function () {
            hideError();
            $('#loginBox input[type="text"], #loginBox input[type="password"]').removeClass('form-error');
            if (!$('#username').val().trim()) {
                $('#username').addClass('form-error');
                showError("Please enter username.");
                return;
            }
            if (!$('#password').val().trim()) {
                $('#password').addClass('form-error');
                showError("Please enter password.");
                return;
            }
            const user = $('#username').val();
            const pass = $('#password').val();
            if (user === adminUser && pass === adminPass) {
                // Remember me functionality
                if ($('#rememberMe').is(':checked')) {
                    localStorage.setItem("zakmedcare_admin_user", user);
                    localStorage.setItem("zakmedcare_admin_pass", pass);
                } else {
                    localStorage.removeItem("zakmedcare_admin_user");
                    localStorage.removeItem("zakmedcare_admin_pass");
                }
                $('#loginBox').fadeOut(200, function () {
                    $('#uploadSection').fadeIn(300);
                    $('#adminJobListSection').fadeIn(300);
                    $('#backToWebsiteWrap').hide(); // Hide back button below login after login
                });
                renderAdminJobList();
            } else {
                showError("❌ Invalid credentials!");
            }
        });

        // Show image preview
        $("#imageInput").on("change", function () {
            const input = this;
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    $("#imagePreview").attr("src", e.target.result);
                    $("#imagePreviewWrap").removeClass("hidden");
                }
                reader.readAsDataURL(input.files[0]);
            } else {
                $("#imagePreviewWrap").addClass("hidden");
            }
        });

        // Clear image preview and file input
        $("#clearImageBtn").on("click", function () {
            $("#imageInput").val('');
            $("#imagePreview").attr("src", "#");
            $("#imagePreviewWrap").addClass("hidden");
        });

        // Modal functions for previewing image large
        function showImgModal(src) {
            $("#modalImage").attr("src", src);
            $("#imgModal").removeClass("hidden");
            document.body.style.overflow = 'hidden';
        }
        function closeImgModal() {
            $("#imgModal").addClass("hidden");
            $("#modalImage").attr("src", "");
            document.body.style.overflow = '';
        }
        window.showImgModal = showImgModal;
        window.closeImgModal = closeImgModal;
        document.addEventListener('keydown', function (e) {
            if (e.key === "Escape") closeImgModal();
        });

        // Job Posting Form Submission - No fields are mandatory!
        $('#uploadForm').submit(function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            // Get selected licenses as an array
            const licenses = [];
            $('input[name="license[]"]:checked').each(function () { licenses.push($(this).val()); });
            formData.set('license', licenses.join(', '));

            const btn = $(this).find('button[type="submit"]');
            btn.prop('disabled', true).text('Submitting...');
            $('#uploadStatus').removeClass().text('');

            // Read image as Base64 so it can be displayed on the public page (demo purpose)
            let reader;
            if ($("#imageInput")[0].files[0]) {
                reader = new FileReader();
                reader.onload = function (e) {
                    saveJob(formData, e.target.result);
                };
                reader.readAsDataURL($("#imageInput")[0].files[0]);
            } else {
                saveJob(formData, "");
            }

            function saveJob(formData, imgSrc) {
                // Check if all fields are empty
                const fields = [
                    formData.get('title'),
                    formData.get('position'),
                    formData.get('industry'),
                    formData.get('location'),
                    formData.get('salary'),
                    formData.get('experience'),
                    formData.get('candidates'),
                    formData.get('license'),
                    formData.get('gender'),
                    formData.get('description'),
                    imgSrc
                ];
                const allEmpty = fields.every(val => !val || val.trim() === "");
                if (allEmpty) {
                    $('#uploadStatus').text("Please fill at least one field before submitting.").removeClass().addClass('text-red-600 font-semibold text-center');
                    btn.prop('disabled', false).text('Submit Job');
                    return;
                }
                // Save to localStorage for demonstration; in production, send to backend
                let jobs = [];
                if (localStorage.getItem('jobs')) {
                    jobs = JSON.parse(localStorage.getItem('jobs'));
                }
                const job = {
                    title: formData.get('title') || "",
                    position: formData.get('position') || "",
                    industry: formData.get('industry') || "",
                    location: formData.get('location') || "",
                    salary: formData.get('salary') || "",
                    experience: formData.get('experience') || "",
                    candidates: formData.get('candidates') || "",
                    license: formData.get('license') || "",
                    gender: formData.get('gender') || "",
                    description: formData.get('description') || "",
                    image: imgSrc
                };
                jobs.unshift(job); // Add to top
                localStorage.setItem('jobs', JSON.stringify(jobs));
                $('#uploadStatus').text("Job posted successfully! Redirecting...").addClass('text-green-700');
                $('#uploadForm')[0].reset();
                $("#imagePreviewWrap").addClass("hidden");
                btn.prop('disabled', false).text('Submit Job');
                renderAdminJobList();
                setTimeout(function () {
                    window.location.href = "index.html";
                }, 1200);
            }
        });

        // Admin Job List rendering
        function renderAdminJobList() {
            let jobs = [];
            if (localStorage.getItem('jobs')) {
                jobs = JSON.parse(localStorage.getItem('jobs'));
            }
            const container = $("#adminJobList");
            if (!jobs.length) {
                container.html(`<p class="text-center text-gray-500">You have not posted any jobs yet.</p>`);
                return;
            }
            container.html(jobs.map((job, idx) => {
                // If only image is present (all other fields empty), show image big
                const fields = ["title", "position", "industry", "location", "salary", "experience", "candidates", "license", "gender", "description"];
                const isImageOnly = job.image && fields.every(f => !job[f] || job[f].toString().trim() === "");
                if (isImageOnly) {
                    return `
            <div class="border-b py-6 flex flex-col items-center">
              <img src="${job.image}" alt="Logo" class="w-full max-w-2xl h-96 object-contain rounded border shadow cursor-pointer mb-4" onclick="showImgModal('${job.image}')">
              <div class="flex gap-2 mt-2">
                <button class="job-action-btn text-blue-700 border hover:bg-blue-50 px-3 py-1 rounded font-medium text-sm" onclick="editJob(${idx})">
                  Edit
                </button>
                <button class="job-action-btn text-red-600 border hover:bg-red-50 px-3 py-1 rounded font-medium text-sm" onclick="deleteJob(${idx})">
                  Delete
                </button>
              </div>
            </div>
          `;
                }
                // Otherwise, regular job with details
                return `
          <div class="border-b py-6 flex flex-col md:flex-row md:items-center md:justify-between gap-2">
            <div class="flex items-center gap-4 flex-1">
              ${job.image ? `<img src="${job.image}" alt="Logo" class="w-14 h-14 object-cover rounded border cursor-pointer" onclick="showImgModal('${job.image}')">` : ''}
              <div>
                <div class="font-semibold text-lg text-blue-700">${job.title || '<span class="text-gray-400">No Title</span>'}</div>
                <div class="text-gray-600">${job.position || ''} ${job.industry ? '· ' + job.industry : ''} ${job.location ? '· ' + job.location : ''}</div>
                <div class="text-xs text-gray-400">${job.salary ? 'Salary: ' + job.salary + ' AED' : ''}</div>
              </div>
            </div>
            <div class="flex gap-2 mt-2 md:mt-0">
              <button class="job-action-btn text-blue-700 border hover:bg-blue-50 px-3 py-1 rounded font-medium text-sm" onclick="editJob(${idx})">
                Edit
              </button>
              <button class="job-action-btn text-red-600 border hover:bg-red-50 px-3 py-1 rounded font-medium text-sm" onclick="deleteJob(${idx})">
                Delete
              </button>
            </div>
          </div>
        `;
            }).join(''));
        }

        // Delete Job function
        function deleteJob(idx) {
            if (!confirm("Are you sure you want to delete this job posting?")) return;
            let jobs = [];
            if (localStorage.getItem('jobs')) {
                jobs = JSON.parse(localStorage.getItem('jobs'));
            }
            jobs.splice(idx, 1);
            localStorage.setItem('jobs', JSON.stringify(jobs));
            renderAdminJobList();
        }

        // Edit Job function (basic demo: loads job data into form for editing and removes the old job)
        function editJob(idx) {
            let jobs = [];
            if (localStorage.getItem('jobs')) {
                jobs = JSON.parse(localStorage.getItem('jobs'));
            }
            const job = jobs[idx];
            // Prefill the form
            $('#uploadForm').find('[name=title]').val(job.title);
            $('#uploadForm').find('[name=position]').val(job.position);
            $('#uploadForm').find('[name=industry]').val(job.industry);
            $('#uploadForm').find('[name=location]').val(job.location);
            $('#uploadForm').find('[name=candidates]').val(job.candidates);
            $('#uploadForm').find('[name=salary]').val(job.salary);
            $('#uploadForm').find('[name=experience]').val(job.experience);
            $('#uploadForm').find('[name=gender]').val(job.gender);
            $('#uploadForm').find('[name=description]').val(job.description);
            // Uncheck all licenses, then check those in job.license
            $('input[name="license[]"]').prop('checked', false);
            if (job.license) {
                job.license.split(',').forEach(l => {
                    $(`input[name="license[]"][value="${l.trim()}"]`).prop('checked', true);
                });
            }
            $("#imagePreviewWrap").addClass("hidden");
            $("#imageInput").val('');
            // Remove the old job
            jobs.splice(idx, 1);
            localStorage.setItem('jobs', JSON.stringify(jobs));
            renderAdminJobList();
            // Scroll to form
            $('html,body').animate({ scrollTop: $("#uploadSection").offset().top - 20 }, 400);
        }
        window.editJob = editJob;
        window.deleteJob = deleteJob;
    </script>
</body>

</html>